<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent("gorilla-move", {
        schema: { speed: { type: "number", default: 0.4 } },
        init: function () {
          this.velocity = new THREE.Vector3();
          this.player = this.el.object3D;
          this.prevLeftPos = new THREE.Vector3();
          this.prevRightPos = new THREE.Vector3();
          this.leftHand = document.querySelector("#leftHand").object3D;
          this.rightHand = document.querySelector("#rightHand").object3D;
        },
        tick: function (time, delta) {
          const hands = [
            { obj: this.leftHand, prev: this.prevLeftPos },
            { obj: this.rightHand, prev: this.prevRightPos }
          ];

          hands.forEach((handData) => {
            let hand = handData.obj;
            let prevPos = handData.prev;
            let handPos = hand.position.clone();

            if (handPos.y < 0.2) { // Hand touches the ground
              let movement = handPos.clone().sub(prevPos); // Calculate hand movement
              this.velocity.add(movement.negate().multiplyScalar(this.data.speed));
            }

            prevPos.copy(handPos);
          });

          // Apply velocity to player movement
          this.player.position.addScaledVector(this.velocity, delta / 1000);
          this.velocity.multiplyScalar(0.85); // Apply friction
          
          // Prevent player from falling through floor
          if (this.player.position.y < 1.0) {
            this.player.position.y = 1.0;
            this.velocity.y = 0;
          }
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <!-- Player Rig -->
      <a-entity id="player" gorilla-move>
        <a-entity camera position="0 1.6 0"></a-entity>
        
        <!-- Left Hand -->
        <a-entity id="leftHand" oculus-touch-controls="hand: left">
          <a-cylinder height="0.5" radius="0.05" color="brown"></a-cylinder> <!-- Arm -->
          <a-sphere position="0 -0.3 0" radius="0.08" color="black"></a-sphere> <!-- Hand -->
        </a-entity>

        <!-- Right Hand -->
        <a-entity id="rightHand" oculus-touch-controls="hand: right">
          <a-cylinder height="0.5" radius="0.05" color="brown"></a-cylinder>
          <a-sphere position="0 -0.3 0" radius="0.08" color="black"></a-sphere>
        </a-entity>
      </a-entity>

      <!-- Environment -->
      <a-plane position="0 0 -5" rotation="-90 0 0" width="10" height="10" color="green"></a-plane>
      <a-box position="0 1 -3" width="1" height="1" depth="1" color="blue"></a-box> <!-- Obstacle -->
    </a-scene>
  </body>
</html>
